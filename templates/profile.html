<div class="profile-page-wrapper">
    <div class="card">
        <div class="avatar-section">
            <img src="/static/uploads/{{ user[11] or 'default.png' }}" alt="Profile Avatar" class="avatar-image"/>
            <input type="file" id="avatarInput" accept="image/*" style="display:none;">
            <button type="button" class="avatar-btn" onclick="document.getElementById('avatarInput').click()">Change Avatar</button>
        </div>
        <h2 class="section-title">Your Profile</h2>
        <form method="POST" enctype="multipart/form-data" class="signup-form" id="profileForm">
            <input name="avatar" id="avatarField" type="hidden">
            <label>Name</label>
            <input name="name" value="{{ user[1] }}" required>

            <label>Email</label>
            <input value="{{ user[2] }}" disabled>

            <label>Class Level</label>
            <select name="class_level" required>
                <option {% if user[4] == '1' %}selected{% endif %}>1</option>
                <option {% if user[4] == '2' %}selected{% endif %}>2</option>
                <option {% if user[4] == '3' %}selected{% endif %}>3</option>
                <option {% if user[4] == '4' %}selected{% endif %}>4</option>
                <option {% if user[4] == '5' %}selected{% endif %}>5</option>
            </select>

            <label>Board</label>
            <select name="board" required>
                <option {% if user[5] == 'ICSE' %}selected{% endif %}>ICSE</option>
                <option {% if user[5] == 'CBSE' %}selected{% endif %}>CBSE</option>
                <option {% if user[5] == 'WBSC' %}selected{% endif %}>WBSC</option>
            </select>

            <button type="submit" class="hero-cta">Save Changes</button>
        </form>
        <div class="card">
            <p><strong>XP:</strong> {{ user[6] }}</p>
            <p><strong>Level:</strong> {{ user[7] }}</p>
            <p><strong>Streak:</strong> {{ user[8] }}</p>
            <p><strong>Medals:</strong> {{ user[9] }}</p>
        </div>
    </div>
</section>
<script>
document.getElementById('avatarInput').addEventListener('change', function(e) {
    const form = document.getElementById('profileForm');
    const formData = new FormData(form);
    formData.append('avatar', e.target.files[0]);
    
    const newForm = new FormData();
    newForm.append('avatar', e.target.files[0]);
    newForm.append('name', form.elements['name'].value);
    newForm.append('class_level', form.elements['class_level'].value);
    newForm.append('board', form.elements['board'].value);
    
    fetch('/profile', {
        method: 'POST',
        body: newForm
    }).then(() => location.reload());
});
</script>
{% endblock %}
